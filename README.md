# Movielens
This project implements a k-nearest-neighbor collaborative filtering algorithm for recommender systems with different distance/similarity measurement methods, and compares the results generated with various configurations.

## Setup

### Prerequisities
* C++ Language Dialect: GNU++11
* [`argp`](http://www.gnu.org/software/libc/manual/html_node/Argp.html) Library
* To generate plots, [`Rscript`](https://www.r-project.org) is required.
* To run tests, `gtest v1.7.0` is required.

### Installation
A makefile is provided, so simply run `make` in the project root directory to compile the source code.

If you see an errror related to `argp`, you can try add `-largp` after `LDFLAGS` in the Makefile, e.g. `LDFLAGS   = -largp`.

You will see an executable `movielens.exec` when compilation succeeds.

## Usage
```
Usage: movielens.exec [OPTION...]
Movie lens data analyzer

  -d, --method=method        Method used for similarity measure.
                             0: COS, 1: L1, 2: L2, 3: PCC
  -k, --neighbor-num=number  Number of neighbora.
  -m, --movie-num=number     Max number of movies
  -o, --matched-only         Only include neighbors that have matched item
  -p, --pretty-print         Print results in a human-readable way
  -r, --train-data=file      Path to training data
  -t, --test-data=file       Path to test data
  -u, --user-num=number      Max number of users
  -?, --help                 Give this help list
      --usage                Give a short usage message
```

#### Example
```
./movielens.exec -k20 -d0 -m3952 -u6040 -r./data/ml-1m/u5.base -t./data/ml-1m/u5.test -o
```

## Implementation

### Data Structures
This project heavily depends on STL containers, including `vector`, `list`, and `unordered_map`. Details are available in `common.hpp`.

### MovieLens Data Reader
`readData` function in `datareader` reads MovieLens data and store them in data structures mentioned in the above section.

### NeighborsLocator
The class `NeighborsLocator` locates neighbors for a certain user with k and method provided by the caller.  

## Tests
 Some simple test cases to prove the correctness of the four similarity/distance measure methods are in `movielens/Tests/`. Tests are built on top of `gtest`.


## Experiments
Experiments were conducted by running the script `experiment.sh`.  
**Note** The script starts three processes in parallel at a time.

### Specifications
* 4 methods: Cosine, L1, L2, PCC
* 3 Ks: 5, 10, 20
* 2 sizes of data: [100k](http://grouplens.org/datasets/movielens/100k/), [1m](http://grouplens.org/datasets/movielens/1m/)
  * 5 sets of data per size (generated by `split_ratings.sh` and `allbut.pl` if they are not directly provided by MovieLens)
* 2 ways to select neighbors:
  * Include all neighbors
  * Only include neighbors with matched movie

240 combinations can be derived from above, and each combination is repeated 3 times, therefore 720 sets result in total.

### Results
The raw results are in `raw_results/`. An Excel spreadsheet `results.xlsx` that includes some basic statistics measures is provided. Visualized data plots are in `Rplots.pdf`, which were generated by `plot.r`.

## Author
Weimin Ouyang
